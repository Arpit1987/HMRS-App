name: AI PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  java-code-review:
    name: Java Code Review
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Create PR Review
      run: |
        echo "## ðŸ” AI Assisted Code Review" > review.md
        echo "" >> review.md
        echo "### âŒ Critical Issues" >> review.md
        echo "" >> review.md
        echo "**1. Poor validation in add method**" >> review.md
        echo "- Missing input validation for parameters" >> review.md
        echo "- No integer overflow bounds checking" >> review.md
        echo "- Consider adding null checks and range validation" >> review.md
        echo "" >> review.md
        echo "**2. Incorrect string concatenation**" >> review.md
        echo "- \`System.out.println(\"Adding numbers: \" + a + b)\` will concatenate incorrectly" >> review.md
        echo "- Should be: \`\"Adding numbers: \" + (a + b)\` or use \`String.format()\`" >> review.md
        echo "" >> review.md
        echo "**3. No divide-by-zero handling**" >> review.md
        echo "- Method will throw \`ArithmeticException\` when b=0" >> review.md
        echo "- Add validation: \`if (b == 0) throw new IllegalArgumentException(\"Divisor cannot be zero\")\`" >> review.md
        echo "" >> review.md
        echo "### âš ï¸ Code Quality Issues" >> review.md
        echo "" >> review.md
        echo "**4. Unused method**" >> review.md
        echo "- \`formatMessage\` method is defined but never used" >> review.md
        echo "- Remove if unnecessary or add \`@Deprecated\` annotation" >> review.md
        echo "" >> review.md
        echo "**5. Poor logging practice**" >> review.md
        echo "- Using \`System.out.println\` in production code" >> review.md
        echo "- Consider using SLF4J or Log4j for proper logging" >> review.md
        echo "" >> review.md
        echo "### ðŸ“ Suggestions" >> review.md
        echo "" >> review.md
        echo "**6. Add documentation**" >> review.md
        echo "- Missing Javadoc for all public methods" >> review.md
        echo "- Document parameters, return values, and exceptions" >> review.md
        echo "" >> review.md
        echo "**Recommendation**: Request changes until critical issues are resolved." >> review.md
        
        # Use --request-changes instead of --event REQUEST_CHANGES
        gh pr review ${{ github.event.pull_request.number }} --body-file review.md --request-changes
        
        echo "âœ… PR review submitted!"
        
      env:
        GH_TOKEN: ${{ github.token }}