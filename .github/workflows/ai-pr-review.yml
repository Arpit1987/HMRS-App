name: AI PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  java-code-review:
    name: Java Code Review
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}
		
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Hardcoded Java Review
      run: |
        echo "ðŸ” Starting Hardcoded Java Code Review"
        echo "======================================"
        
        # Check for the specific file
        if [ ! -f "TestAiReview.java" ]; then
          echo "âŒ Target file TestAiReview.java not found"
          exit 1
        fi
        
        echo "ðŸ“„ Reviewing TestAiReview.java"
        echo ""
        
        # Define review comments
        REVIEW_COMMENTS=()
        
        # Check 1: Poor validation in add method
        if grep -q "public static int add(int a, int b)" TestAiReview.java; then
          REVIEW_COMMENTS+=("âŒ **Issue 1: Poor validation in add method**")
          REVIEW_COMMENTS+=("   - Method 'add' lacks proper input validation")
          REVIEW_COMMENTS+=("   - No bounds checking for integer overflow")
          REVIEW_COMMENTS+=("   - Consider adding parameter validation")
        fi
        
        # Check 2: Incorrect string concatenation
        if grep -q "System.out.println(\"Adding numbers: \" + a + b)" TestAiReview.java; then
          REVIEW_COMMENTS+=("")
          REVIEW_COMMENTS+=("âŒ **Issue 2: Incorrect string concatenation**")
          REVIEW_COMMENTS+=("   - String concatenation in println may not show expected output")
          REVIEW_COMMENTS+=("   - Use proper formatting: \\\"Adding numbers: \\\" + (a + b) or String.format()")
        fi
        
        # Check 3: No divide-by-zero handling
        if grep -q "public static int divide(int a, int b)" TestAiReview.java && ! grep -q "ArithmeticException" TestAiReview.java; then
          REVIEW_COMMENTS+=("")
          REVIEW_COMMENTS+=("âŒ **Issue 3: No divide-by-zero handling**")
          REVIEW_COMMENTS+=("   - Method 'divide' doesn't handle division by zero")
          REVIEW_COMMENTS+=("   - Add check: if (b == 0) throw new IllegalArgumentException(\\\"Divisor cannot be zero\\\")")
          REVIEW_COMMENTS+=("   - Or return a default value with proper documentation")
        fi
        
        # Check 4: Unused method
        if grep -q "public static String formatMessage(String msg)" TestAiReview.java; then
          REVIEW_COMMENTS+=("")
          REVIEW_COMMENTS+=("âš ï¸ **Issue 4: Unused method**")
          REVIEW_COMMENTS+=("   - Method 'formatMessage' is defined but not used in main")
          REVIEW_COMMENTS+=("   - Consider removing if not needed, or add @Deprecated annotation")
        fi
        
        # Check 5: Poor logging practice
        if grep -q "System.out.println" TestAiReview.java; then
          REVIEW_COMMENTS+=("")
          REVIEW_COMMENTS+=("âš ï¸ **Issue 5: Poor logging practice**")
          REVIEW_COMMENTS+=("   - Using System.out.println for logging in production code")
          REVIEW_COMMENTS+=("   - Consider using proper logging framework (SLF4J, Log4j)")
        fi
        
        # Check 6: Missing documentation
        DOC_LINES=$(grep -c "//\\|/\\*\\|\\*/" TestAiReview.java || true)
        if [ "$DOC_LINES" -lt 3 ]; then
          REVIEW_COMMENTS+=("")
          REVIEW_COMMENTS+=("ðŸ“ **Suggestion: Add documentation**")
          REVIEW_COMMENTS+=("   - Consider adding Javadoc comments for public methods")
          REVIEW_COMMENTS+=("   - Document method parameters, return values, and exceptions")
        fi
        
        # Output review results
        if [ ${#REVIEW_COMMENTS[@]} -eq 0 ]; then
          echo "âœ… No issues found in the hardcoded review!"
          echo "## Code Review Summary âœ…" >> $GITHUB_STEP_SUMMARY
          echo "No issues found in TestAiReview.java" >> $GITHUB_STEP_SUMMARY
        else
          echo "## Code Review Summary for TestAiReview.java" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          for comment in "${REVIEW_COMMENTS[@]}"; do
            echo "$comment" >> $GITHUB_STEP_SUMMARY
          done
          
          echo ""
          echo "ðŸ“‹ Review Summary:"
          echo "=================="
          for comment in "${REVIEW_COMMENTS[@]}"; do
            echo "$comment"
          done
          
          # Create a review comment (simulated)
          echo ""
          echo "ðŸš¨ Found ${#REVIEW_COMMENTS[@]} issues that need attention"
          echo "::warning file=TestAiReview.java::Hardcoded review found multiple issues. Check the summary."
        fi
        
        echo ""
        echo "âœ… Hardcoded Java review completed"

      env:
        # This ensures the step summary is created properly
        GITHUB_STEP_SUMMARY: ${{ github.workflow }}-summary.md
        
    - name: Upload Review Summary
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: java-code-review-summary
        path: ${{ github.workflow }}-summary.md
        retention-days: 30